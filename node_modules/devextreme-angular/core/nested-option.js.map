{"version":3,"file":"nested-option.js","sourceRoot":"","sources":["nested-option.ts"],"names":[],"mappings":"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","sourcesContent":["/*!\n * devextreme-angular\n * Version: 19.2.3\n * Build date: Tue Oct 22 2019\n *\n * Copyright (c) 2012 - 2019 Developer Express Inc. ALL RIGHTS RESERVED\n *\n * This software may be modified and distributed under the terms\n * of the MIT license. See the LICENSE file in the root of the project for details.\n *\n * https://github.com/DevExpress/devextreme-angular\n */\n\nimport { QueryList, ElementRef, Renderer2, EventEmitter } from '@angular/core';\r\n\r\nimport { DX_TEMPLATE_WRAPPER_CLASS } from './template';\r\nimport { getElement } from './utils';\r\n\r\nimport * as render from 'devextreme/core/renderer';\r\nimport * as events from 'devextreme/events';\r\n\r\nconst VISIBILITY_CHANGE_SELECTOR = 'dx-visibility-change-handler';\r\n\r\nexport interface INestedOptionContainer {\r\n    instance: any;\r\n    isLinked: boolean;\r\n    optionChangedHandlers: EventEmitter<any>;\r\n}\r\n\r\nexport interface IOptionPathGetter { (): string; }\r\n\r\nexport abstract class BaseNestedOption implements INestedOptionContainer, ICollectionNestedOptionContainer {\r\n    protected _host: INestedOptionContainer;\r\n    protected _hostOptionPath: IOptionPathGetter;\r\n    private _collectionContainerImpl: ICollectionNestedOptionContainer;\r\n    protected _initialOptions = {};\r\n\r\n    protected abstract get _optionPath(): string;\r\n    protected abstract _fullOptionPath(): string;\r\n\r\n    constructor() {\r\n        this._collectionContainerImpl = new CollectionNestedOptionContainerImpl(this._setOption.bind(this), this._filterItems.bind(this));\r\n    }\r\n\r\n    protected _optionChangedHandler(e: any) {\r\n        let fullOptionPath = this._fullOptionPath();\r\n\r\n        if (e.fullName.indexOf(fullOptionPath) === 0) {\r\n            let optionName = e.fullName.slice(fullOptionPath.length);\r\n            let emitter = this[optionName + 'Change'];\r\n\r\n            if (emitter) {\r\n                emitter.next(e.value);\r\n            }\r\n        }\r\n    }\r\n\r\n    protected _createEventEmitters(events) {\r\n        events.forEach(event => {\r\n            this[event.emit] = new EventEmitter();\r\n        });\r\n    }\r\n\r\n    protected _getOption(name: string): any {\r\n        if (this.isLinked) {\r\n            return this.instance.option(this._fullOptionPath() + name);\r\n        } else {\r\n            return this._initialOptions[name];\r\n        }\r\n    }\r\n\r\n    protected _setOption(name: string, value: any) {\r\n        if (this.isLinked) {\r\n            this.instance.option(this._fullOptionPath() + name, value);\r\n        } else {\r\n            this._initialOptions[name] = value;\r\n        }\r\n    }\r\n\r\n    setHost(host: INestedOptionContainer, optionPath: IOptionPathGetter) {\r\n        this._host = host;\r\n        this._hostOptionPath = optionPath;\r\n        this.optionChangedHandlers.subscribe(this._optionChangedHandler.bind(this));\r\n    }\r\n\r\n    setChildren<T extends ICollectionNestedOption>(propertyName: string, items: QueryList<T>) {\r\n        return this._collectionContainerImpl.setChildren(propertyName, items);\r\n    }\r\n\r\n    _filterItems(items: QueryList<BaseNestedOption>) {\r\n        return items.filter((item) => { return item !== this; });\r\n    }\r\n\r\n    get instance() {\r\n        return this._host && this._host.instance;\r\n    }\r\n\r\n    get isLinked() {\r\n        return !!this.instance && this._host.isLinked;\r\n    }\r\n\r\n    get optionChangedHandlers() {\r\n        return this._host && this._host.optionChangedHandlers;\r\n    }\r\n}\r\n\r\nexport interface ICollectionNestedOptionContainer {\r\n    setChildren<T extends ICollectionNestedOption>(propertyName: string, items: QueryList<T>);\r\n}\r\n\r\nexport class CollectionNestedOptionContainerImpl implements ICollectionNestedOptionContainer {\r\n    private _activatedQueries = {};\r\n\r\n    constructor(private _setOption: Function, private _filterItems?: Function) {}\r\n\r\n    setChildren<T extends ICollectionNestedOption>(propertyName: string, items: QueryList<T>) {\r\n        if (this._filterItems) {\r\n            items = this._filterItems(items);\r\n        }\r\n        if (items.length) {\r\n            this._activatedQueries[propertyName] = true;\r\n        }\r\n        if (this._activatedQueries[propertyName]) {\r\n            let widgetItems = items.map((item, index) => {\r\n                item._index = index;\r\n                return item._value;\r\n            });\r\n            this._setOption(propertyName, widgetItems);\r\n        }\r\n    }\r\n}\r\n\r\nexport abstract class NestedOption extends BaseNestedOption {\r\n    setHost(host: INestedOptionContainer, optionPath: IOptionPathGetter) {\r\n        super.setHost(host, optionPath);\r\n\r\n        this._host[this._optionPath] = this._initialOptions;\r\n    }\r\n\r\n    protected _fullOptionPath() {\r\n        return this._hostOptionPath() + this._optionPath + '.';\r\n    }\r\n}\r\n\r\nexport interface ICollectionNestedOption {\r\n    _index: number;\r\n    _value: Object;\r\n}\r\n\r\nexport abstract class CollectionNestedOption extends BaseNestedOption implements ICollectionNestedOption {\r\n    _index: number;\r\n\r\n    protected _fullOptionPath() {\r\n        return this._hostOptionPath() + this._optionPath + '[' + this._index + ']' + '.';\r\n    }\r\n\r\n    get _value() {\r\n        return this._initialOptions;\r\n    }\r\n\r\n    get isLinked() {\r\n        return this._index !== undefined && !!this.instance && this._host.isLinked;\r\n    }\r\n}\r\n\r\nexport interface IOptionWithTemplate extends BaseNestedOption {\r\n    template: any;\r\n}\r\n\r\nlet triggerShownEvent = function(element) {\r\n    let changeHandlers = [];\r\n\r\n    if (!render(element).hasClass(VISIBILITY_CHANGE_SELECTOR)) {\r\n        changeHandlers.push(element);\r\n    }\r\n\r\n    changeHandlers.push.apply(changeHandlers, element.querySelectorAll('.' + VISIBILITY_CHANGE_SELECTOR));\r\n\r\n    for (let i = 0; i < changeHandlers.length; i++) {\r\n        events.triggerHandler(changeHandlers[i], 'dxshown');\r\n    }\r\n};\r\n\r\nexport function extractTemplate(option: IOptionWithTemplate, element: ElementRef, renderer: Renderer2, document: any) {\r\n    if (!option.template === undefined || !element.nativeElement.hasChildNodes()) {\r\n        return;\r\n    }\r\n\r\n    let childNodes = [].slice.call(element.nativeElement.childNodes);\r\n    let userContent = childNodes.filter((n) => {\r\n        if (n.tagName) {\r\n            let tagNamePrefix = n.tagName.toLowerCase().substr(0, 3);\r\n            return !(tagNamePrefix === 'dxi' || tagNamePrefix === 'dxo');\r\n        } else {\r\n            return n.nodeName !== '#comment' && n.textContent.replace(/\\s/g, '').length;\r\n        }\r\n    });\r\n    if (!userContent.length) {\r\n        return;\r\n    }\r\n\r\n    option.template = {\r\n        render: (renderData) => {\r\n            let result = element.nativeElement;\r\n\r\n            renderer.addClass(result, DX_TEMPLATE_WRAPPER_CLASS);\r\n\r\n            if (renderData.container) {\r\n                let container = getElement(renderData.container);\r\n                let resultInContainer = container.contains(element.nativeElement);\r\n\r\n                renderer.appendChild(container, element.nativeElement);\r\n\r\n                if (!resultInContainer) {\r\n                    let resultInBody = document.body.contains(container);\r\n\r\n                    if (resultInBody) {\r\n                        triggerShownEvent(result);\r\n                    }\r\n                }\r\n            }\r\n\r\n            return result;\r\n        }\r\n    };\r\n}\r\n\r\nexport class NestedOptionHost {\r\n    private _host: INestedOptionContainer;\r\n    private _optionPath: IOptionPathGetter;\r\n\r\n    setHost(host: INestedOptionContainer, optionPath?: IOptionPathGetter) {\r\n        this._host = host;\r\n        this._optionPath = optionPath || (() => '');\r\n    }\r\n\r\n    setNestedOption(nestedOption: BaseNestedOption) {\r\n        nestedOption.setHost(this._host, this._optionPath);\r\n    }\r\n}\r\n"]}