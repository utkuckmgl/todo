{"version":3,"file":"watcher-helper.js","sourceRoot":"","sources":["watcher-helper.ts"],"names":[],"mappings":"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","sourcesContent":["/*!\n * devextreme-angular\n * Version: 19.2.3\n * Build date: Tue Oct 22 2019\n *\n * Copyright (c) 2012 - 2019 Developer Express Inc. ALL RIGHTS RESERVED\n *\n * This software may be modified and distributed under the terms\n * of the MIT license. See the LICENSE file in the root of the project for details.\n *\n * https://github.com/DevExpress/devextreme-angular\n */\n\nimport {\r\n    Injectable\r\n} from '@angular/core';\r\n\r\nimport * as commonUtils from 'devextreme/core/utils/common';\r\n\r\n@Injectable()\r\nexport class WatcherHelper {\r\n    private _watchers: any[] = [];\r\n\r\n    getWatchMethod() {\r\n        let watchMethod = (valueGetter, valueChangeCallback, options) => {\r\n            let oldValue = valueGetter();\r\n            options = options || {};\r\n\r\n            if (!options.skipImmediate) {\r\n                valueChangeCallback(oldValue);\r\n            }\r\n\r\n            let watcher = () => {\r\n                let newValue = valueGetter();\r\n\r\n                if (this._isDifferentValues(oldValue, newValue, options.deep)) {\r\n                    valueChangeCallback(newValue);\r\n                    oldValue = newValue;\r\n                }\r\n            };\r\n\r\n            this._watchers.push(watcher);\r\n\r\n            return () => {\r\n                let index = this._watchers.indexOf(watcher);\r\n\r\n                if (index !== -1) {\r\n                    this._watchers.splice(index, 1);\r\n                }\r\n            };\r\n        };\r\n\r\n        return watchMethod;\r\n    }\r\n\r\n    private _isDifferentValues(oldValue: any, newValue: any, deepCheck: boolean) {\r\n        let comparableNewValue = this._toComparable(newValue);\r\n        let comparableOldValue = this._toComparable(oldValue);\r\n        let isObjectValues = comparableNewValue instanceof Object && comparableOldValue instanceof Object;\r\n\r\n        if (deepCheck && isObjectValues) {\r\n            return this._checkObjectsFields(newValue, oldValue);\r\n        }\r\n        return comparableNewValue !== comparableOldValue;\r\n    }\r\n\r\n    private _toComparable(value) {\r\n        if (value instanceof Date) {\r\n            return value.getTime();\r\n        }\r\n\r\n        return value;\r\n    }\r\n\r\n    private _checkObjectsFields(checkingFromObject: Object, checkingToObject: Object) {\r\n        for (let field in checkingFromObject) {\r\n            let oldValue = this._toComparable(checkingFromObject[field]);\r\n            let newValue = this._toComparable(checkingToObject[field]);\r\n            let isEqualObjects = false;\r\n\r\n            if (typeof oldValue === 'object' && typeof newValue === 'object') {\r\n                isEqualObjects = commonUtils.equalByValue(oldValue, newValue);\r\n            }\r\n            if (oldValue !== newValue && !isEqualObjects) {\r\n                return true;\r\n            }\r\n        }\r\n    }\r\n\r\n    checkWatchers() {\r\n       for (let watcher of this._watchers) {\r\n            watcher();\r\n        }\r\n    }\r\n}\r\n"]}